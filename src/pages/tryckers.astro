---
import BaseLayout from "../layouts/BaseLayout.astro"

// Obtener la lista de suscriptores desde la funci√≥n Netlify (SSR)
const apiUrl = "https://trycatch.tv/.netlify/functions/twitch-subscribers"

// Definir el tipo para los suscriptores
interface TwitchSub {
  user_name: string
  user_profile_image_url?: string
  created_at?: string
  plan_name?: string
  is_gift?: boolean
}

let subs: TwitchSub[] = []
try {
  const res = await fetch(apiUrl)
  const data = await res.json()
  // El array de subs est√° en data.data seg√∫n la respuesta de la API de Twitch
  subs = data.data || []
} catch (e) {
  subs = []
}

const info = {
  titleTeam: "Tryckers Team",
  tryckersTeam: [
    {
      username: "ElProgramadorGT",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/7fb16515-ed68-4fdd-9ec9-94630c05de09-profile_image-70x70.png",
      url: "https://www.twitch.tv/elprogramadorgt",
    },
    {
      username: "ChrisVDev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/33d67b61-c1be-4f36-9cbc-10aabf9a4f4c-profile_image-70x70.png",
      url: "https://www.twitch.tv/chrisvdev",
    },
    {
      username: "FrancoLabs",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/2e456aac-989b-41e4-af41-9c1179da4782-profile_image-70x70.png",
      url: "https://www.twitch.tv/francolabs",
    },
    {
      username: "CodingWithStrangers",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/dc386d21-87c4-498e-8d53-bad77fc23141-profile_image-70x70.png",
      url: "https://www.twitch.tv/codingwithstrangers",
    },
    {
      username: "AntonyDev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/8d6c1156-584e-4543-a679-4fa61f30d7a3-profile_image-70x70.png",
      url: "https://www.twitch.tv/antonydev",
    },
    {
      username: "MetalitoDev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/81d6dc2a-1378-45f2-898a-02bee1aff39d-profile_image-70x70.png",
      url: "https://www.twitch.tv/metalitodev",
    },
    {
      username: "The_FrontDev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/bf627c06-5e31-4962-82ca-ea4f340b43d5-profile_image-70x70.jpeg",
      url: "https://www.twitch.tv/the_frontdev",
    },
    {
      username: "QuantumApprentice",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/e45d8530-48a4-4f82-9449-18cda04d7a23-profile_image-70x70.png",
      url: "https://www.twitch.tv/quantumapprentice",
    },
  ],
  titleSubs: "Tryckers Subs",
  tryckersPremium: [
    {
      username: "MranDvX",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/164bb36d-db91-4c50-aafb-0734c475a3f2-profile_image-70x70.png",
      since: "Febrero 2023",
    },
    {
      username: "JaimACuSdev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/fa794444-a97c-40ea-82b6-7ff54d771a6b-profile_image-70x70.png",
      since: "Mayo 2023",
    },
    {
      username: "ApitoriaDev",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/e6e52ab3-691b-403f-8dbc-4347ea57f36b-profile_image-70x70.png",
      since: "Agosto 2023",
    },
    {
      username: "Nexeum",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-70x70.png",
      since: "Enero 2024",
    },
    {
      username: "ManuPro",
      platform: "Twitch",
      avatar:
        "https://static-cdn.jtvnw.net/jtv_user_pictures/7b943b44-427b-4921-b777-45bf7ac58631-profile_image-70x70.png",
      since: "Octubre 2023",
    },
  ],
  titleDestacados: "Tryckers Destacados",
  tryckersDestacados: [
    {
      username: "",
      platform: "",
      avatar: "",
    },
  ],
}
---

<BaseLayout title={`Tryckers`}>
  <div
    class="max-w-5xl mx-auto my-16 p-10 bg-tc-black border border-gray-700 rounded-lg shadow-xl mt-24"
  >
    <h2
      class="text-tc-yellow text-3xl font-bold text-center mb-6 uppercase tracking-wide"
    >
      {info.titleTeam}
    </h2>
    <hr class="border-gray-600 mb-6" />

    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
    >
      {
        info.tryckersTeam.map((trycker) => (
          <a href={trycker.url} target="_blank" class="group">
            <div class="bg-tc-black-l rounded-lg shadow-md hover:shadow-2xl transition-transform transform hover:scale-105 p-6 flex flex-col items-center text-center border border-gray-700">
              <img
                class="rounded-full h-24 w-24 object-cover mb-4 border-4 border-gray-600 shadow-lg transition-transform transform group-hover:scale-110"
                src={trycker.avatar}
                alt={trycker.username}
              />
              <h3 class="text-purple-400 font-bold text-lg">
                {trycker.username}
              </h3>
              <p class="text-gray-300 text-sm">{trycker.platform}</p>
            </div>
          </a>
        ))
      }
    </div>

    <h2
      class="text-tc-yellow text-3xl font-bold text-center mt-12 mb-6 uppercase tracking-wide"
    >
      {info.titleSubs}
    </h2>
    <hr class="border-gray-600 mb-6" />

    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
    >
      {
        subs.length === 0 ? (
          <div class="col-span-4 text-center text-gray-400">
            No hay suscriptores activos o no se pudo obtener la lista.
          </div>
        ) : (
          subs.map((sub) => (
            <div class="bg-tc-black-l rounded-lg shadow-md hover:shadow-2xl transition-transform transform hover:scale-105 p-6 flex flex-col items-center text-center border border-gray-700">
              <img
                class="rounded-full h-24 w-24 object-cover mb-4 border-4 border-gray-600 shadow-lg transition-transform transform hover:scale-110"
                src={
                  sub.user_profile_image_url ||
                  "https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-70x70.png"
                }
                alt={sub.user_name}
              />
              <h3 class="text-tc-yellow font-bold text-lg">{sub.user_name}</h3>
              {sub.plan_name && (
                <p class="text-purple-400 text-xs mt-1">
                  {sub.plan_name} {sub.is_gift ? "üéÅ" : ""}
                </p>
              )}
              {sub.created_at && (
                <p class="text-gray-400 text-xs mt-1">
                  Desde {new Date(sub.created_at).toLocaleDateString("es-CO")}
                </p>
              )}
            </div>
          ))
        )
      }
    </div>
  </div>
</BaseLayout>
